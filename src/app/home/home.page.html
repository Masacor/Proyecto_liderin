<ion-header [translucent]="true">
  <ion-toolbar class="blue-toolbar">
    <div class="header-content">
      <div class="logo-section">
        <img src="https://i5.walmartimages.com/dfw/63fd9f59-4a2e/587a39f4-fa04-49c6-b70f-ed494f49ff69/v1/chile-walmart-od-logo.svg" 
             alt="L칤der" 
             class="logo" 
             routerLink="/home"
             style="cursor: pointer;">
      </div>
      <div class="empty-space"></div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="container">
    <!-- Layout con avatar y opciones -->
    <div class="chat-layout">
      
      <!-- Avatar Liderin - SIEMPRE VISIBLE -->
      <div class="avatar-section">
        
        <!-- Selector de avatar - ARRIBA -->
        <div class="avatar-selector-minimal" *ngIf="!isInConversation">
          <div class="selector-label">
            <ion-icon name="person-circle-outline"></ion-icon>
            <span>Elige tu avatar</span>
          </div>
          <div class="selector-buttons">
            <button class="selector-btn" 
                    [class.active]="currentAvatar === 'assets/images/liderin.png'"
                    (click)="changeAvatar('assets/images/liderin.png')">
              <ion-icon name="sparkles"></ion-icon>
              <span>Avatar 1</span>
            </button>
            <button class="selector-btn" 
                    [class.active]="currentAvatar === 'assets/images/liderin2.png'"
                    (click)="changeAvatar('assets/images/liderin2.png')">
              <ion-icon name="star"></ion-icon>
              <span>Avatar 2</span>
            </button>
          </div>
        </div>

        <img [src]="currentAvatar" alt="Liderin" class="avatar-img">
        
        <!-- Input de chat integrado -->
        <div class="integrated-chat-input" *ngIf="showChatInput">
          <ion-textarea
            [(ngModel)]="userMessage"
            placeholder="Escribe tu mensaje a Lider칤n..."
            rows="1"
            autoGrow="true"
            (keyup.enter)="sendMessage()"
          ></ion-textarea>
          <ion-button (click)="sendMessage()" [disabled]="!userMessage.trim() || isLoading">
            <ion-icon name="send"></ion-icon>
          </ion-button>
        </div>
      </div>

      <!-- 游 CONTENIDO DIN츼MICO: OPCIONES O RESPUESTA DEL CHAT -->
      <div class="content-section">
        
        <!-- OPCIONES DE CONVERSACI칍N - SE OCULTAN CUANDO SE CONVERSA -->
        <div class="options-section" *ngIf="!isInConversation">
          <h2>Conversa conmigo para poder ayudarte</h2>
          
          <ion-list class="options-list">
            <!-- Opci칩n principal -->
            <ion-item button class="main-option" lines="none" (click)="startConversation()">
              <ion-icon slot="start" name="chatbubbles"></ion-icon>
              <ion-label>Comenzar a conversar</ion-label>
            </ion-item>

            <!-- Opciones secundarias -->
            <ion-item button class="secondary-option" lines="none" (click)="navigateToPriceCheck()">
              <ion-icon slot="start" name="pricetag"></ion-icon>
              <ion-label>Preg칰ntame por el precio de un producto</ion-label>
            </ion-item>

            <ion-item button class="secondary-option" lines="none" (click)="navigateToStoreLocator()">
              <ion-icon slot="start" name="location"></ion-icon>
              <ion-label>Preg칰ntame d칩nde comprar un producto</ion-label>
            </ion-item>

            <ion-item button class="secondary-option" lines="none" (click)="navigateToOffers()">
              <ion-icon slot="start" name="megaphone"></ion-icon>
              <ion-label>Preg칰ntame por ofertas</ion-label>
            </ion-item>

            <ion-item button class="secondary-option" lines="none" (click)="navigateToRecipes()">
              <ion-icon slot="start" name="restaurant"></ion-icon>
              <ion-label>Preg칰ntame como hacer una receta de cocina</ion-label>
            </ion-item>

            <ion-item button class="secondary-option" lines="none" (click)="navigateToAppDownload()">
              <ion-icon slot="start" name="phone-portrait"></ion-icon>
              <ion-label>Descarga nuestra App M칩vil para registrar tus compras</ion-label>
            </ion-item>
          </ion-list>
        </div>

        <!-- 游 RESPUESTA DEL CHAT - APARECE CUANDO SE CONVERSA -->
        <div class="chat-response-section" *ngIf="isInConversation">
          
          <!-- Cabecera con bot칩n para volver -->
          <div class="chat-header">
            <ion-button fill="clear" size="small" (click)="endConversation()">
              <ion-icon name="arrow-back" slot="start"></ion-icon>
              Volver a opciones
            </ion-button>
          </div>

          <!-- Cuadro de texto del avatar -->
          <div class="avatar-bubble-response">
            <p>{{ chatMessage }}</p>
            <div class="typing-indicator" *ngIf="isLoading">
              <ion-spinner name="crescent"></ion-spinner>
              <span>Lider칤n est치 escribiendo...</span>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</ion-content>