<ion-header [translucent]="true">
  <!-- Barra azul superior con logo -->
  <ion-toolbar class="blue-toolbar">
    <div class="header-content">
      <!-- Logo L√≠der a la izquierda -->
      <div class="logo-section">
        <img src="https://i5.walmartimages.com/dfw/63fd9f59-4a2e/587a39f4-fa04-49c6-b70f-ed494f49ff69/v1/chile-walmart-od-logo.svg" 
             alt="L√≠der" 
             class="logo" 
             routerLink="/home"
             style="cursor: pointer;">
      </div>
      <!-- Espacio vac√≠o para balancear -->
      <div class="empty-space"></div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- MODO C√ÅMARA ACTIVA -->
  <div class="camera-mode" *ngIf="isScanning">
    <video #videoElement autoplay playsinline class="camera-view"></video>
    <canvas #canvasElement class="hidden-canvas"></canvas>
    
    <div class="scanner-overlay">
      <div class="scanner-frame">
        <div class="scanning-laser"></div>
        <div class="scanning-text">Escaneando...</div>
      </div>
    </div>
    
    <div class="scanner-instructions">
      <div class="instruction-item">
        <ion-icon name="camera"></ion-icon>
        <span>Enfoca el c√≥digo de barras del producto</span>
      </div>
      <div class="instruction-item">
        <ion-icon name="scan"></ion-icon>
        <span>La c√°mara detectar√° autom√°ticamente</span>
      </div>
    </div>

    <div class="scanner-controls">
      <ion-button expand="block" color="danger" (click)="stopScanner()">
        <ion-icon slot="start" name="close"></ion-icon>
        Cancelar Escaneo
      </ion-button>
    </div>
  </div>

  <!-- MODO B√öSQUEDA NORMAL -->
  <div class="search-mode" *ngIf="!isScanning">
    <div class="container">
      <h2>Consultar Precio de Productos</h2>
      
      <!-- Mensaje de error -->
      <div class="error-message" *ngIf="scanError">
        <ion-icon name="warning"></ion-icon>
        <div class="error-content">
          <strong>Error:</strong>
          <span>{{ scanError }}</span>
        </div>
      </div>
      
      <!-- OPCI√ìN 1: Buscar por texto -->
      <div class="search-section">
        <div class="section-title">
          <ion-icon name="search"></ion-icon>
          <h3>Buscar por Nombre</h3>
        </div>
        
        <ion-item>
          <ion-input 
            placeholder="Ej: Leche, Arroz, Aceite, T√©..."
            [(ngModel)]="productName"
            (keyup.enter)="searchProduct()"
          ></ion-input>
        </ion-item>
        
        <ion-button expand="block" (click)="searchProduct()" [disabled]="!productName.trim()">
          <ion-icon slot="start" name="search"></ion-icon>
          Buscar Producto
        </ion-button>
      </div>

      <div class="separator">
        <span>O</span>
      </div>

      <!-- OPCI√ìN 2: Escanear c√≥digo de barras -->
      <div class="scan-section">
        <div class="section-title">
          <ion-icon name="camera"></ion-icon>
          <h3>Escanear C√≥digo de Barras</h3>
        </div>
        
        <ion-button expand="block" color="secondary" (click)="startBarcodeScan()">
          <ion-icon slot="start" name="barcode"></ion-icon>
          Activar C√°mara para Escanear
        </ion-button>
        
        <div class="scan-help">
          <p>üì± Usa la c√°mara de tu dispositivo para escanear el c√≥digo de barras</p>
          <p>üîç El sistema buscar√° autom√°ticamente en la base de datos</p>
        </div>
      </div>

      <!-- Loading durante escaneo -->
      <div class="loading-section" *ngIf="isLoading && !isScanning">
        <div class="loading-content">
          <ion-spinner name="crescent"></ion-spinner>
          <p>Buscando productos en la base de datos...</p>
        </div>
      </div>

      <!-- Resultados de b√∫squeda -->
      <div class="results-section" *ngIf="showResults && !isLoading">
        <div class="results-header">
          <div class="results-info">
            <ion-icon name="cart"></ion-icon>
            <div>
              <h3>{{ searchResults.length }} producto(s) encontrado(s)</h3>
              <span *ngIf="scannedBarcode" class="scan-info">C√≥digo escaneado: {{ scannedBarcode }}</span>
            </div>
          </div>
          <ion-button fill="clear" size="small" (click)="clearSearch()">
            <ion-icon slot="start" name="close"></ion-icon>
            Limpiar
          </ion-button>
        </div>

        <!-- Sin resultados -->
        <div class="no-results" *ngIf="searchResults.length === 0">
          <div class="no-results-content">
            <ion-icon name="search-circle"></ion-icon>
            <h4>No se encontraron productos</h4>
            <p *ngIf="scannedBarcode">
              El c√≥digo <strong>"{{ scannedBarcode }}"</strong> no est√° registrado en la base de datos.
            </p>
            <p *ngIf="!scannedBarcode">
              Intenta con otros t√©rminos de b√∫squeda o escanea un c√≥digo de barras.
            </p>
          </div>
        </div>

        <!-- Con resultados -->
        <div class="products-grid" *ngIf="searchResults.length > 0">
          <ion-card *ngFor="let product of searchResults" class="product-card">
            <div class="card-header">
              <div class="product-badge" *ngIf="product.inOffer">
                <span>üî• OFERTA</span>
              </div>
              <ion-card-title>{{ product.name }}</ion-card-title>
              <ion-card-subtitle>{{ product.brand }}</ion-card-subtitle> <!-- ‚úÖ Corregido -->
            </div>
            
            <ion-card-content>
              <div class="product-details">
                <div class="detail-item">
                  <ion-icon name="pricetag"></ion-icon>
                  <div class="price-section">
                    <span class="price" [class.on-offer]="product.inOffer">
                      $ {{ product.price.toLocaleString('es-CL') }}
                    </span>
                    <span class="offer-price" *ngIf="product.inOffer">
                      $ {{ product.offerPrice?.toLocaleString('es-CL') }}
                    </span>
                  </div>
                </div>
                
                <div class="detail-item">
                  <ion-icon name="apps"></ion-icon>
                  <span>{{ product.category }}</span>
                </div>

              </div>
            </ion-card-content>
          </ion-card>
        </div>

        <!-- Bot√≥n para nueva b√∫squeda -->
        <div class="new-search" *ngIf="searchResults.length > 0">
          <ion-button expand="block" fill="outline" (click)="clearSearch()">
            <ion-icon slot="start" name="refresh"></ion-icon>
            Realizar Nueva B√∫squeda
          </ion-button>
        </div>
      </div>
    </div>
  </div>
</ion-content>