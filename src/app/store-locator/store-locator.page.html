<ion-header [translucent]="true">
  <!-- Barra azul superior con logo -->
  <ion-toolbar class="blue-toolbar">
    <div class="header-content">
      <!-- Logo L√≠der a la izquierda -->
      <div class="logo-section">
        <img src="https://i5.walmartimages.com/dfw/63fd9f59-4a2e/587a39f4-fa04-49c6-b70f-ed494f49ff69/v1/chile-walmart-od-logo.svg" 
             alt="L√≠der" 
             class="logo" 
             routerLink="/home"
             style="cursor: pointer;">
      </div>
      <!-- Espacio vac√≠o para balancear -->
      <div class="empty-space"></div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="container">
    <h2>¬øD√≥nde encontrar productos en el supermercado?</h2>
    
    <!-- B√∫squeda -->
    <div class="search-section">
      <ion-item>
        <ion-input 
          placeholder="Ej: Leche, Arroz, Aceite, T√©..."
          [(ngModel)]="searchQuery"
          (keyup.enter)="searchProductLocation()"
        ></ion-input>
      </ion-item>
      
      <ion-button expand="block" (click)="searchProductLocation()" [disabled]="!searchQuery.trim()">
        <ion-icon slot="start" name="search"></ion-icon>
        Buscar Ubicaci√≥n
      </ion-button>
    </div>

    <!-- Loading -->
    <div class="loading" *ngIf="isLoading">
      <ion-spinner></ion-spinner>
      <p>Buscando ubicaciones...</p>
    </div>

    <!-- Resultados de b√∫squeda -->
    <div class="results-section" *ngIf="showResults && !isLoading && !selectedProduct">
      <div class="results-header">
        <h3>
          <ion-icon name="location"></ion-icon>
          {{ searchResults.length }} producto(s) encontrado(s)
        </h3>
        <ion-button size="small" (click)="clearSearch()" *ngIf="searchResults.length > 0">
          Nueva B√∫squeda
        </ion-button>
      </div>

      <!-- Sin resultados -->
      <div class="no-results" *ngIf="searchResults.length === 0">
        <ion-icon name="map"></ion-icon>
        <h4>No se encontraron productos</h4>
        <p>Intenta con otros t√©rminos de b√∫squeda</p>
      </div>

      <!-- Lista de resultados -->
      <div class="products-list" *ngIf="searchResults.length > 0">
        <ion-card *ngFor="let product of searchResults" class="product-card" (click)="selectProduct(product)">
          <ion-card-header>
            <ion-card-title>{{ product.name }}</ion-card-title>
            <ion-card-subtitle>{{ product.brand }}</ion-card-subtitle>
          </ion-card-header>
          
          <ion-card-content>
            <div class="product-info">
              <ion-chip color="primary" *ngIf="product.supermarketLocation">
                <ion-icon name="navigate"></ion-icon>
                <ion-label>{{ product.supermarketLocation.aisle }}</ion-label>
              </ion-chip>
              <p>Toca para ver detalles de ubicaci√≥n</p>
            </div>
          </ion-card-content>
        </ion-card>
      </div>
    </div>

    <!-- Detalles de ubicaci√≥n -->
    <div class="location-details" *ngIf="selectedProduct && selectedProduct.supermarketLocation">
      <div class="location-header">
        <ion-button fill="clear" (click)="backToResults()">
          <ion-icon slot="start" name="arrow-back"></ion-icon>
          Volver
        </ion-button>
        <h3>Ubicaci√≥n de {{ selectedProduct.name }}</h3>
      </div>

      <ion-card class="location-card">
        <ion-card-header>
          <div class="location-icon">
            <span class="aisle-icon">{{ getAisleIcon(selectedProduct.supermarketLocation!.aisle) }}</span>
          </div>
          <ion-card-title>{{ selectedProduct.name }}</ion-card-title>
          <ion-card-subtitle>{{ selectedProduct.brand }}</ion-card-subtitle>
        </ion-card-header>

        <ion-card-content>
          <div class="location-steps">
            <div class="step">
              <div class="step-number">1</div>
              <div class="step-content">
                <strong>Dir√≠gete a:</strong>
                <span class="step-highlight">{{ selectedProduct.supermarketLocation!.aisle }}</span>
              </div>
            </div>

            <div class="step">
              <div class="step-number">2</div>
              <div class="step-content">
                <strong>Busca en la secci√≥n:</strong>
                <span class="step-highlight">{{ selectedProduct.supermarketLocation!.section }}</span>
              </div>
            </div>

            <div class="step">
              <div class="step-number">3</div>
              <div class="step-content">
                <strong>Revisa el estante:</strong>
                <span class="step-highlight">{{ selectedProduct.supermarketLocation!.shelf }}</span>
              </div>
            </div>
          </div>

          <div class="additional-info">
            <ion-chip color="success" *ngIf="selectedProduct.stores && selectedProduct.stores.length > 0">
              <ion-icon name="storefront"></ion-icon>
              <ion-label>Disponible en {{ selectedProduct.stores.length }} tienda(s)</ion-label>
            </ion-chip>

            <div class="price-info" *ngIf="selectedProduct.inOffer">
              <ion-text color="danger">
                <strong>¬°OFERTA! ${{ selectedProduct.offerPrice?.toLocaleString('es-CL') }}</strong>
              </ion-text>
            </div>
          </div>
        </ion-card-content>
      </ion-card>

      <div class="location-tips">
        <h4>üí° Consejos para encontrar el producto:</h4>
        <ul>
          <li>Busca las se√±ales del pasillo en el techo</li>
          <li>Los productos similares est√°n agrupados juntos</li>
          <li>Pregunta a un empleado si necesitas ayuda</li>
        </ul>
      </div>
    </div>
  </div>
</ion-content>